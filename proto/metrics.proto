syntax = "proto3";

package aurora.metrics.v1;

option go_package = "aurora-kvm-agent/proto/metricsv1";

import "node_metric.proto";
import "node_info.proto";
import "vm_metric.proto";
import "vm_info.proto";

message StreamAck {
  string node_id = 1;
  int64 accepted_at_unix = 2;
  string message = 3;
}

service MetricsService {
  rpc StreamNodeMetrics(stream NodeMetricsFrame) returns (StreamAck);
  rpc StreamVMMetrics(stream VMMetricsFrame) returns (StreamAck);
  rpc StreamVMRuntimeMetrics(stream VMRuntimeMetricsFrame) returns (StreamAck);
  rpc ReportNodeStaticMetrics(NodeStaticMetricsFrame) returns (StreamAck);
  rpc SyncNodeInfo(NodeInfoSync) returns (StreamAck);
  rpc SyncVMInfo(VMInfoSync) returns (StreamAck);
}

service AgentService {
  rpc GetVersion(AgentVersionRequest) returns (AgentVersionResponse);
  rpc CreateVM(AgentCreateVMRequest) returns (AgentVMOperationResponse);
  rpc UpdateVM(AgentUpdateVMRequest) returns (AgentVMOperationResponse);
  rpc DeleteVM(AgentDeleteVMRequest) returns (AgentVMOperationResponse);
  rpc MigrateVM(AgentMigrateVMRequest) returns (AgentVMOperationResponse);
}
